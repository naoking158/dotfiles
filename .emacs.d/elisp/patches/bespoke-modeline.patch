*** /tmp/ediffSolI1N	2021-09-30 16:27:24.854235009 +0900
--- /tmp/ediff8KfRiY	2021-09-30 16:27:24.857568336 +0900
***************
*** 183,245 ****
  
  (defun bespoke-modeline-compose (status name primary secondary)
    "Compose a string with provided information"
!   (let* ((char-width    (window-font-width nil 'header-line))
!          (window        (get-buffer-window (current-buffer)))
!          (active        (eq window bespoke-modeline--selected-window))
!          (space-up       +0.20)
!          (space-down     -0.20)
           ;; Use status letters for TTY display
! 	     (prefix          (if (display-graphic-p)
!                               (cond ((string= status bespoke-mode-line-gui-ro-symbol)
! 			                         (propertize (if (window-dedicated-p)" –– " bespoke-mode-line-gui-ro-symbol) 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face)))
!                                     ((string= status bespoke-mode-line-gui-mod-symbol)
! 			                         (propertize (if (window-dedicated-p)" –– " bespoke-mode-line-gui-mod-symbol) 'face (if active 'bespoke-modeline-mod-face 'bespoke-modeline-inactive-face)))
!                                     ((string= status bespoke-mode-line-gui-rw-symbol)
! 		                             (propertize (if (window-dedicated-p)" –– " bespoke-mode-line-gui-rw-symbol) 'face (if active 'bespoke-modeline-default-face 'bespoke-modeline-inactive-face)))
!                                     (t (propertize status 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face))))
! 
!                             (cond ((string= status bespoke-mode-line-tty-ro-symbol)
! 			                       (propertize (if (window-dedicated-p)" -- " bespoke-mode-line-tty-ro-symbol) 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face)))
!                                   ((string= status bespoke-mode-line-tty-mod-symbol)
! 			                       (propertize (if (window-dedicated-p)" -- " bespoke-mode-line-tty-mod-symbol) 'face (if active 'bespoke-modeline-mod-face 'bespoke-modeline-inactive-face)))
!                                   ((string= status  bespoke-mode-line-tty-rw-symbol)
! 		                           (propertize (if (window-dedicated-p)" -- " bespoke-mode-line-tty-rw-symbol) 'face (if active 'bespoke-modeline-default-face 'bespoke-modeline-inactive-face)))
!                                   (t (propertize status 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face))))))
           (left (concat
!                 (propertize " "  'face (if active (cond ((eq bespoke-set-mode-line 'header)
!                                                          'header-line)
!                                                         ((eq bespoke-set-mode-line 'footer)
!                                                          'mode-line)
!                                                         ((eq bespoke-set-mode-line nil)
!                                                          'mode-line))
!                                          'fringe)
! 			                'display `(raise ,space-up))
!                 (propertize name 'face (if active (cond ((eq bespoke-set-mode-line 'header)
!                                                          'header-line)
!                                                         ((eq bespoke-set-mode-line 'footer)
!                                                          'mode-line)
!                                                         ((eq bespoke-set-mode-line nil)
!                                                          'mode-line))
!                                          'fringe))
!                 (propertize " "  'face (if active (cond ((eq bespoke-set-mode-line 'header)
!                                                          'header-line)
!                                                         ((eq bespoke-set-mode-line 'footer)
!                                                          'mode-line)
!                                                         ((eq bespoke-set-mode-line nil)
!                                                          'mode-line))
!                                          'fringe)
! 		                    'display `(raise ,space-down))
                  (if (derived-mode-p 'deft-mode)
                      (propertize primary 'face 'match)
! 	              (propertize primary 'face 'fringe))))
!          (right (concat secondary " "))
           (available-width (- (window-total-width)
! 			                 (length prefix) (length left) (length right)
! 			                 (/ (window-right-divider-width) char-width)))
           (available-width (max 1 available-width)))
!     (concat prefix
! 	        left
! 	        (propertize (make-string available-width ?\ )
                          'face (if active (cond ((eq bespoke-set-mode-line 'header)
                                                  'header-line)
                                                 ((eq bespoke-set-mode-line 'footer)
--- 183,299 ----
  
  (defun bespoke-modeline-compose (status name primary secondary)
    "Compose a string with provided information"
!   (let* ((char-width (window-font-width nil 'header-line))
!          (window (get-buffer-window (current-buffer)))
!          (active (eq window bespoke-modeline--selected-window))
!          (space-up +0.20)
!          (space-down -0.20)
           ;; Use status letters for TTY display
! 				 (prefix (if (display-graphic-p)
!                      (cond ((string= status bespoke-mode-line-gui-ro-symbol)
! 														(propertize (if (window-dedicated-p) " –– "
! 																					bespoke-mode-line-gui-ro-symbol)
! 																				'face
! 																				(if active 'bespoke-modeline-ro-face
! 																					'bespoke-modeline-inactive-face)))
!                            ((string= status bespoke-mode-line-gui-mod-symbol)
! 														(propertize (if (window-dedicated-p) " –– "
! 																					bespoke-mode-line-gui-mod-symbol)
! 																				'face
! 																				(if active 'bespoke-modeline-mod-face
! 																					'bespoke-modeline-inactive-face)))
!                            ((string= status bespoke-mode-line-gui-rw-symbol)
! 														(propertize (if (window-dedicated-p)" –– "
! 																					bespoke-mode-line-gui-rw-symbol)
! 																				'face
! 																				(if active 'bespoke-modeline-default-face
! 																					'bespoke-modeline-inactive-face)))
!                            (t
! 														(propertize status
! 																				'face
! 																				(if active 'bespoke-modeline-ro-face
! 																					'bespoke-modeline-inactive-face))))
! 
!                    (cond ((string= status bespoke-mode-line-tty-ro-symbol)
! 													(propertize (if (window-dedicated-p) " -- "
! 																				bespoke-mode-line-tty-ro-symbol)
! 																			'face
! 																			(if active 'bespoke-modeline-ro-face
! 																				'bespoke-modeline-inactive-face)))
!                          ((string= status bespoke-mode-line-tty-mod-symbol)
! 													(propertize (if (window-dedicated-p) " -- "
! 																				bespoke-mode-line-tty-mod-symbol)
! 																			'face
! 																			(if active 'bespoke-modeline-mod-face
! 																				'bespoke-modeline-inactive-face)))
!                          ((string= status bespoke-mode-line-tty-rw-symbol)
! 													(propertize (if (window-dedicated-p) " -- "
! 																				bespoke-mode-line-tty-rw-symbol)
! 																			'face
! 																			(if active 'bespoke-modeline-default-face
! 																				'bespoke-modeline-inactive-face)))
!                          (t
! 													(propertize status
! 																			'face
! 																			(if active 'bespoke-modeline-ro-face
! 																				'bespoke-modeline-inactive-face))))))
           (left (concat
!                 (propertize " "  'face
! 														(if active (cond ((eq bespoke-set-mode-line 'header)
! 																							'header-line)
! 																						 ((eq bespoke-set-mode-line 'footer)
! 																							'mode-line)
! 																						 ((eq bespoke-set-mode-line nil)
! 																							'mode-line))
!                               'fringe)
! 														'display `(raise ,space-up))
!                 (propertize name 'face
! 														(if active (cond ((eq bespoke-set-mode-line 'header)
!                                               'header-line)
!                                              ((eq bespoke-set-mode-line 'footer)
!                                               'mode-line)
!                                              ((eq bespoke-set-mode-line nil)
!                                               'mode-line))
!                               'fringe))
!                 (propertize " "  'face
! 														(if active (cond ((eq bespoke-set-mode-line 'header)
!                                               'header-line)
!                                              ((eq bespoke-set-mode-line 'footer)
!                                               'mode-line)
!                                              ((eq bespoke-set-mode-line nil)
!                                               'mode-line))
!                               'fringe)
! 														'display `(raise ,space-down))
                  (if (derived-mode-p 'deft-mode)
                      (propertize primary 'face 'match)
! 									(propertize primary 'face 'fringe))
! 								
! 								(when (and org-mode-line-string
! 													 (not (or (bespoke-modeline-term-mode-p)
! 																		(bespoke-modeline-vterm-mode-p)
! 																		(bespoke-modeline-completion-list-mode-p)
! 																		(bespoke-modeline-calendar-mode-p)
! 																		(bespoke-modeline-org-capture-mode-p)
! 																		(bespoke-modeline-org-agenda-mode-p))))
! 									(propertize "  "  'face
! 															(if active (cond ((eq bespoke-set-mode-line 'header)
! 																								'header-line)
! 																							 ((eq bespoke-set-mode-line 'footer)
! 																								'mode-line)
! 																							 ((eq bespoke-set-mode-line nil)
! 																								'mode-line))
! 																'fringe)
! 															'display `(raise ,space-down))
! 									(propertize org-mode-line-string 'face 'fringe))))
! 				 (right
! 					(concat secondary " "))			 
           (available-width (- (window-total-width)
! 														 (length prefix) (length left) (length right)
! 														 (/ (window-right-divider-width) char-width)))
           (available-width (max 1 available-width)))
! 		(concat prefix
! 						left
! 						(propertize (make-string available-width ?\ )
                          'face (if active (cond ((eq bespoke-set-mode-line 'header)
                                                  'header-line)
                                                 ((eq bespoke-set-mode-line 'footer)
***************
*** 254,259 ****
--- 308,386 ----
                                                       ((eq bespoke-set-mode-line nil)
                                                        'mode-line))
                                        'fringe)))))
+ ;; (defun bespoke-modeline-compose (status name primary secondary)
+ ;;   "Compose a string with provided information"
+ ;;   (let* ((char-width (window-font-width nil 'header-line))
+ ;;          (window (get-buffer-window (current-buffer)))
+ ;;          (active (eq window bespoke-modeline--selected-window))
+ ;;          (space-up +0.20)
+ ;;          (space-down -0.20)
+ ;;          ;; Use status letters for TTY display
+ ;; 				 (prefix (if (display-graphic-p)
+ ;;                      (cond ((string= status bespoke-mode-line-gui-ro-symbol)
+ ;; 														(propertize (if (window-dedicated-p)" –– " bespoke-mode-line-gui-ro-symbol) 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face)))
+ ;;                            ((string= status bespoke-mode-line-gui-mod-symbol)
+ ;; 														(propertize (if (window-dedicated-p)" –– " bespoke-mode-line-gui-mod-symbol) 'face (if active 'bespoke-modeline-mod-face 'bespoke-modeline-inactive-face)))
+ ;;                            ((string= status bespoke-mode-line-gui-rw-symbol)
+ ;; 														(propertize (if (window-dedicated-p)" –– " bespoke-mode-line-gui-rw-symbol) 'face (if active 'bespoke-modeline-default-face 'bespoke-modeline-inactive-face)))
+ ;;                            (t (propertize status 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face))))
+ 
+ ;;                    (cond ((string= status bespoke-mode-line-tty-ro-symbol)
+ ;; 													(propertize (if (window-dedicated-p)" -- " bespoke-mode-line-tty-ro-symbol) 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face)))
+ ;;                          ((string= status bespoke-mode-line-tty-mod-symbol)
+ ;; 													(propertize (if (window-dedicated-p)" -- " bespoke-mode-line-tty-mod-symbol) 'face (if active 'bespoke-modeline-mod-face 'bespoke-modeline-inactive-face)))
+ ;;                          ((string= status  bespoke-mode-line-tty-rw-symbol)
+ ;; 													(propertize (if (window-dedicated-p)" -- " bespoke-mode-line-tty-rw-symbol) 'face (if active 'bespoke-modeline-default-face 'bespoke-modeline-inactive-face)))
+ ;;                          (t (propertize status 'face (if active 'bespoke-modeline-ro-face 'bespoke-modeline-inactive-face))))))
+ ;;          (left (concat
+ ;;                 (propertize " "  'face (if active (cond ((eq bespoke-set-mode-line 'header)
+ ;;                                                          'header-line)
+ ;;                                                         ((eq bespoke-set-mode-line 'footer)
+ ;;                                                          'mode-line)
+ ;;                                                         ((eq bespoke-set-mode-line nil)
+ ;;                                                          'mode-line))
+ ;;                                          'fringe)
+ ;; 														'display `(raise ,space-up))
+ ;;                 (propertize name 'face (if active (cond ((eq bespoke-set-mode-line 'header)
+ ;;                                                          'header-line)
+ ;;                                                         ((eq bespoke-set-mode-line 'footer)
+ ;;                                                          'mode-line)
+ ;;                                                         ((eq bespoke-set-mode-line nil)
+ ;;                                                          'mode-line))
+ ;;                                          'fringe))
+ ;;                 (propertize " "  'face (if active (cond ((eq bespoke-set-mode-line 'header)
+ ;;                                                          'header-line)
+ ;;                                                         ((eq bespoke-set-mode-line 'footer)
+ ;;                                                          'mode-line)
+ ;;                                                         ((eq bespoke-set-mode-line nil)
+ ;;                                                          'mode-line))
+ ;;                                          'fringe)
+ ;; 														'display `(raise ,space-down))
+ ;;                 (if (derived-mode-p 'deft-mode)
+ ;;                     (propertize primary 'face 'match)
+ ;; 									(propertize primary 'face 'fringe))))
+ ;;          (right (concat secondary " "))
+ ;;          (available-width (- (window-total-width)
+ ;; 														 (length prefix) (length left) (length right)
+ ;; 														 (/ (window-right-divider-width) char-width)))
+ ;;          (available-width (max 1 available-width)))
+ ;;     (concat prefix
+ ;; 						left
+ ;; 						(propertize (make-string available-width ?\ )
+ ;;                         'face (if active (cond ((eq bespoke-set-mode-line 'header)
+ ;;                                                 'header-line)
+ ;;                                                ((eq bespoke-set-mode-line 'footer)
+ ;;                                                 'mode-line)
+ ;;                                                ((eq bespoke-set-mode-line nil)
+ ;;                                                 'mode-line))
+ ;;                                 'fringe))
+ ;;             (propertize right 'face (if active (cond ((eq bespoke-set-mode-line 'header)
+ ;;                                                       'header-line)
+ ;;                                                      ((eq bespoke-set-mode-line 'footer)
+ ;;                                                       'mode-line)
+ ;;                                                      ((eq bespoke-set-mode-line nil)
+ ;;                                                       'mode-line))
+ ;;                                       'fringe)))))
  
  ;;;; Mode line status
  ;; ---------------------------------------------------------------------
***************
*** 543,551 ****
                                org-mode-line-string)))
  
  
- 
- 
- 
  ;;; Set Mode line
  ;;;; Set content for mode/header line
  (defvar bespoke--mode-line
--- 670,675 ----
***************
*** 557,564 ****
             ((bespoke-modeline-vterm-mode-p)           (bespoke-modeline-vterm-mode))
             ((bespoke-modeline-text-mode-p)            (bespoke-modeline-default-mode))
             ((bespoke-modeline-pdf-view-mode-p)        (bespoke-modeline-pdf-view-mode))
! 	       ((bespoke-modeline-docview-mode-p)         (bespoke-modeline-docview-mode))
! 	       ((bespoke-modeline-completion-list-mode-p) (bespoke-modeline-completion-list-mode))
             ((bespoke-modeline-calendar-mode-p)        (bespoke-modeline-calendar-mode))
             ((bespoke-modeline-org-capture-mode-p)     (bespoke-modeline-org-capture-mode))
             ((bespoke-modeline-org-agenda-mode-p)      (bespoke-modeline-org-agenda-mode))
--- 681,688 ----
             ((bespoke-modeline-vterm-mode-p)           (bespoke-modeline-vterm-mode))
             ((bespoke-modeline-text-mode-p)            (bespoke-modeline-default-mode))
             ((bespoke-modeline-pdf-view-mode-p)        (bespoke-modeline-pdf-view-mode))
! 					 ((bespoke-modeline-docview-mode-p)         (bespoke-modeline-docview-mode))
! 					 ((bespoke-modeline-completion-list-mode-p) (bespoke-modeline-completion-list-mode))
             ((bespoke-modeline-calendar-mode-p)        (bespoke-modeline-calendar-mode))
             ((bespoke-modeline-org-capture-mode-p)     (bespoke-modeline-org-capture-mode))
             ((bespoke-modeline-org-agenda-mode-p)      (bespoke-modeline-org-agenda-mode))
